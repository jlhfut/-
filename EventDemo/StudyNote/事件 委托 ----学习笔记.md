#### 事件 委托 ----学习笔记

​	**委托：** 

​	将方法作为参数进行传递（中间代理人我自己不做，找人来做）在C#中允许讲一个对象中的方法传递给另一个能调用该方法的类的某个对象。*** 你可以将A类中的方法K（包含在委托当中）传递给一个类B，这样类B就能调用类A中的方法K。*** 同事也可以已静态的方式或是实例的方式来传递该方法。与C++中的以函数指针形式调用其他类中的方法概念类似。

**事件处理函数**

C#中的事件处理函数是一个具有特定参数形式的委托对象，其形式如下：



```c#
public delegate void EventNameEventHandler(object sender,EventNameEventArgs e);
```

第一个参数：**sender** 指明了触发该事件的对象，第二个参数 :**e **包含了在该事件处理函数中可以被运用的一些数据，上面的MyEventArgs 类是从EventArgs类继承过来的，后者是一些运用更广泛的类。如MouseEventArgs类，ListChangedEventArgs类等的积累。对于GUI事件可以使用这些已经被定义好的类的对象来完成处理。 *而对于那些基于非GUI的事件，你必须要从EventArgs类派生出自己的类，并将所要包含的数据传递给委托对象。* 



##### 编写一个事件的4个步骤：

* 在事件发行者中定义一个事件    发布者  -----》杂志社
* 在事件发行者中触发事件           发布者----》杂志社 ---->发行了新版的《狄安娜》杂志
* 在事件订阅者中定义事件处理程序   订阅者----》订书得人---->杂志社发布了新书《狄安娜》（以前订过）
* 向事件发行者订阅一个事件     读者---》订书（出版社）





**程序界面：**

![1611244737332](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1611244737332.png)





**程序源码**

#出版社  -----事件的发布者#

* 在事件发行者中定义一个事件    发布者  -----》杂志社
* 在事件发行者中触发事件           发布者----》杂志社 ---->发行了新版的《狄安娜》杂志

```C#
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace EventDemo
{
    class Publisher
    {
        //编写一个事件的四个步骤

        //1.在事件发行者中定义一个事件
        //2.在事件发行者中触发事件
        //3.在事件订阅这种定义事件处理程序
        //4.向事件发行者订阅一个事件


        //声明事件所需的委托
        public delegate void Courier(string magazineName);

        //声明事件
        public event Courier OnPubComputer;  //
        public event Courier OnPubLife;

        //定义事件触发的方法

        public void issueComputer()//事件触发方法
        {
            if (OnPubComputer != null)
            {
                //MessageBox.show("发行《电脑》杂志");
                OnPubComputer("《电脑杂志》");//方法
            }
        }

        public void issueLife()
        {
            if (OnPubLife != null)
            {
                OnPubLife("《生活》杂志");
            }
        }
    }
}

```



 **订阅者-----读者** 我关注的书籍有变化 我该怎么办

* 在事件订阅者中定义事件处理程序   订阅者----》订书得人---->杂志社发布了新书《狄安娜》
* 向事件发行者订阅一个事件     读者---》订书（出版社）

```C#
namespace EventDemo
{
    class Subscriber  //用户订阅者
    {
        //在事件订阅者中定义事件处理程序   订阅者----》订书得人---->杂志社发布了新书《狄安娜》
        private string userName;

        public Subscriber(string name)//构造函数
        {
            this.userName = name;
        }

        
        public void ReceiveManazine(string magazineName)
        {
            MessageBox.Show(userName + "已经收到" + magazineName);
        }
    }
}
```





**完整程序----订阅事件（事件的注册）**   

向事件发行者订阅一个事件     读者---》订书（出版社）

```C#

namespace EventDemo
{
    public partial class Form1 : Form
    {

        //编写一个事件的四个步骤

        //1.在事件发行者中定义一个事件
        //2.在事件发行者中触发事件
        //3.在事件订阅这种定义事件处理程序
        //4.向事件发行者订阅一个事件

         //1.在事件发行者中定义一个事件
        Publisher SanDonPublisher = new Publisher();
        Subscriber zhangSan = new Subscriber("张三");
        Subscriber liSi = new Subscriber("李四");

        public Form1()
        {
            InitializeComponent();

            
        }

        /// <summary>
        /// 发行电脑刊物
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void btnIssueComputer_Click(object sender, EventArgs e)
        {
            //2.在事件发行者中触发事件  
            SanDonPublisher.issueComputer();   //定义了事件的触发方法   需要订阅者具体的去处理
        }
        

        ///发行《生活杂志》
        private void btnIssueLife_Click(object sender, EventArgs e)
        {
              //2.在事件发行者中触发事件   
            SanDonPublisher.issueLife();//定义了事件的触发方法   需要订阅者具体的去处理
        }

        private void chkComputerZs_CheckedChanged(object sender, EventArgs e)
        {
            if (true == chkComputerZs.Checked)
            {
                 //3.在事件订阅者中定义事件处理程序ReceiveManazine
        		//4.向事件发行者订阅一个事件  +=
                SanDonPublisher.OnPubComputer += new Publisher.Courier(zhangSan.ReceiveManazine);
            }
            else {
                SanDonPublisher.OnPubComputer -= new Publisher.Courier(zhangSan.ReceiveManazine); 
                }
        }

        private void SanDonPublisher_OnPubComputer(string magazineName)
        {
            MessageBox.Show("发行《电脑》杂志");        }

        private void chkLifeZs_CheckedChanged(object sender, EventArgs e)
        {
            if (true == chkLifeZs.Checked)
            {
                SanDonPublisher.OnPubLife += new Publisher.Courier(zhangSan.ReceiveManazine);
            }
            else
            {
                SanDonPublisher.OnPubLife -= new Publisher.Courier(zhangSan.ReceiveManazine);
            }
        }

        private void SanDonPublisher_OnPubLife(string magazineName)
        {
            MessageBox.Show("发行《生活》杂志");
        }

        private void chkComputerLs_CheckedChanged(object sender, EventArgs e)
        {
            if (true == chkComputerLs.Checked)
            {
                SanDonPublisher.OnPubComputer += new Publisher.Courier(liSi.ReceiveManazine);
            }
            else
            {
                SanDonPublisher.OnPubLife -= new Publisher.Courier(liSi.ReceiveManazine);
            }
        }

        private void SanDonPublisher_OnPubLife1(string magazineName)
        {
            throw new NotImplementedException();
        }

        private void chkLifeLs_CheckedChanged(object sender, EventArgs e)
        {
            if (true == chkLifeLs.Checked)
            {
                SanDonPublisher.OnPubLife += new Publisher.Courier(liSi.ReceiveManazine);
            }
            else
            {
                SanDonPublisher.OnPubLife -= new Publisher.Courier(liSi.ReceiveManazine);
            }
        }

       
    }
}

```

